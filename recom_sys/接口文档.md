# Book & Movie Recommender 推荐平台接口文档

## 1. 数据库表完善设计

### 1.1 用户表（tb_users）

| 字段名     | 类型         | 是否主键 | 是否为空 | 默认值            | 说明                     |
| ---------- | ------------ | -------- | -------- | ----------------- | ------------------------ |
| user_id    | BIGINT       | 是       | 否       | 自增              | 用户唯一标识符           |
| username   | VARCHAR(50)  | 否       | 否       | 无                | 用户名                   |
| password   | VARCHAR(255) | 否       | 否       | 无                | 密码哈希值               |
| email      | VARCHAR(100) | 否       | 是       | 无                | 邮箱地址                 |
| avatar_url | VARCHAR(255) | 否       | 是       | 无                | 头像链接                 |
| status     | TINYINT      | 否       | 否       | 1                 | 用户状态：1 正常，0 禁用 |
| created_at | DATETIME     | 否       | 否       | CURRENT_TIMESTAMP | 注册时间                 |
| updated_at | DATETIME     | 否       | 否       | CURRENT_TIMESTAMP | 最后更新时间             |

> 注意：`username` 具有唯一约束。

------

### 1.2 内容表（tb_items）

| 字段名          | 类型         | 是否主键 | 是否为空 | 默认值            | 说明                                                 |
| --------------- | ------------ | -------- | -------- | ----------------- | ---------------------------------------------------- |
| item_id         | BIGINT       | 是       | 否       | 自增              | 内容唯一ID                                           |
| title           | VARCHAR(100) | 否       | 否       | 无                | 书名或电影名                                         |
| type            | VARCHAR(10)  | 否       | 否       | 无                | 内容类型，仅允许 `'book'` 或 `'movie'`               |
| description     | TEXT         | 否       | 是       | NULL              | 简介                                                 |
| cover_url       | VARCHAR(255) | 否       | 是       | NULL              | 封面/海报图片链接                                    |
| release_year    | INT          | 否       | 是       | NULL              | 出版年份（书籍）或上映年份（电影），范围 1800~当前年 |
| author_director | VARCHAR(100) | 否       | 是       | NULL              | **书籍填作者，电影填导演**                           |
| rating_avg      | DECIMAL(3,2) | 否       | 否       | 0.00              | 平均评分（0.00 ~ 10.00）                             |
| rating_count    | INT          | 否       | 否       | 0                 | 评分人数                                             |
| view_count      | INT          | 否       | 否       | 0                 | 浏览次数                                             |
| created_at      | DATETIME     | 否       | 否       | CURRENT_TIMESTAMP | 创建时间                                             |

------

### 1.3 标签表（tb_tags）

| 字段名     | 类型        | 是否主键 | 是否为空 | 默认值            | 说明                               |
| ---------- | ----------- | -------- | -------- | ----------------- | ---------------------------------- |
| tag_id     | BIGINT      | 是       | 否       | 自增              | 标签ID                             |
| tag_name   | VARCHAR(30) | 否       | 否       | 无                | 标签名称，如“科幻”、“悬疑”、“成长” |
| item_count | INT         | 否       | 否       | 0                 | 关联内容数量                       |
| created_at | DATETIME    | 否       | 否       | CURRENT_TIMESTAMP | 创建时间                           |

------

### 1.4 内容-标签关联表（tb_item_tags）

| 字段名  | 类型   | 是否主键 | 是否为空 | 默认值 | 说明   |
| ------- | ------ | -------- | -------- | ------ | ------ |
| item_id | BIGINT | 是       | 否       | 无     | 内容ID |
| tag_id  | BIGINT | 是       | 否       | 无     | 标签ID |

------

### 1.5 用户评分表（tb_ratings）

| 字段名     | 类型     | 是否主键 | 是否为空 | 默认值            | 说明         |
| ---------- | -------- | -------- | -------- | ----------------- | ------------ |
| rating_id  | BIGINT   | 是       | 否       | 自增              | 评分记录ID   |
| user_id    | BIGINT   | 否       | 否       | 无                | 用户ID       |
| item_id    | BIGINT   | 否       | 否       | 无                | 内容ID       |
| score      | TINYINT  | 否       | 否       | 无                | 评分（1~10） |
| created_at | DATETIME | 否       | 否       | CURRENT_TIMESTAMP | 评分时间     |

> 唯一约束：`(user_id, item_id)`，确保每人对每项内容只能评一次。

------

### 1.6 收藏表（tb_favorites）

| 字段名      | 类型     | 是否主键 | 是否为空 | 默认值            | 说明     |
| ----------- | -------- | -------- | -------- | ----------------- | -------- |
| favorite_id | BIGINT   | 是       | 否       | 自增              | 收藏ID   |
| user_id     | BIGINT   | 否       | 否       | 无                | 用户ID   |
| item_id     | BIGINT   | 否       | 否       | 无                | 内容ID   |
| created_at  | DATETIME | 否       | 否       | CURRENT_TIMESTAMP | 收藏时间 |

> 唯一约束：`(user_id, item_id)`

------

## 2. 接口规范

### 2.1 统一响应格式

**成功响应**：

json

编辑

```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": 1623456789000
}
```

**错误响应**：

json

编辑

```json
{
  "code": 400,
  "message": "错误描述",
  "data": null,
  "timestamp": 1623456789000
}
```

### 2.2 统一分页响应格式

json

编辑

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "currentPage": 1,
    "pageSize": 10,
    "total": 100,
    "totalPages": 10,
    "records": [],
    "hasPrevious": false,
    "hasNext": true
  },
  "timestamp": 1623456789000
}
```

### 2.3 响应码定义

| 响应码 | 说明            |
| ------ | --------------- |
| 200    | 请求成功        |
| 400    | 请求参数错误    |
| 401    | 未授权/登录失效 |
| 403    | 权限不足        |
| 404    | 资源不存在      |
| 500    | 服务器内部错误  |

### 2.4 接口前缀约定

- 公共接口前缀：`/api/public`
- 用户接口前缀：`/api/user`

------

## 3. 接口设计

### 3.1 公共接口（/api/public）

#### 3.1.1 用户认证

**用户注册**
 路径：`POST /api/public/register`
 请求参数：

json

编辑

```json
{
  "username": "用户名",
  "password": "密码",
  "email": "邮箱"
}
```

响应示例：

json

编辑

```json
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "userId": 1,
    "username": "alice"
  },
  "timestamp": 1623456789000
}
```

**用户登录**
 路径：`POST /api/public/login`
 请求参数：

json

编辑

```json
{
  "username": "用户名",
  "password": "密码"
}
```

响应示例：

json

编辑

```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "userId": 1,
      "username": "alice"
    }
  },
  "timestamp": 1623456789000
}
```

#### 3.1.2 内容浏览

**获取内容列表**
 路径：`GET /api/public/items`
 请求参数：

- `page`: 页码（默认1）
- `size`: 每页条数（默认10）
- `type`: 类型（'book' / 'movie'，可选）
- `keyword`: 搜索关键词（可选）
- `tagId`: 标签ID筛选（可选）
- `sortBy`: 排序字段（`createdAt` / `ratingAvg` / `viewCount`，默认 `createdAt`）
- `order`: 排序方式（`asc` / `desc`，默认 `desc`）

响应示例（分页）：

json

编辑

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "currentPage": 1,
    "pageSize": 10,
    "total": 50,
    "totalPages": 5,
    "records": [
      {
        "itemId": 1,
        "title": "三体",
        "type": "book",
        "coverUrl": "https://example.com/santi.jpg",
        "authorDirector": "刘慈欣",
        "releaseYear": 2006,
        "ratingAvg": 9.20,
        "tags": ["科幻", "硬核"]
      }
    ],
    "hasPrevious": false,
    "hasNext": true
  },
  "timestamp": 1623456789000
}
```

**获取内容详情**
 路径：`GET /api/public/items/{itemId}`
 响应示例：

json

编辑

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "itemId": 1,
    "title": "三体",
    "type": "book",
    "description": "地球文明与三体文明的首次接触...",
    "coverUrl": "https://example.com/santi.jpg",
    "authorDirector": "刘慈欣",
    "releaseYear": 2006,
    "ratingAvg": 9.20,
    "ratingCount": 1200,
    "viewCount": 5000,
    "tags": ["科幻", "硬核", "宇宙"],
    "isFavorited": false,
    "userRating": null
  },
  "timestamp": 1623456789000
}
```

#### 3.1.3 标签与分类

**获取标签列表**
 路径：`GET /api/public/tags`
 请求参数：`page`, `size`（分页）
 响应格式：同 AetherNet 文档中的标签分页格式。

------

### 3.2 用户接口（/api/user）

#### 3.2.1 个人信息

**获取当前用户信息**
 路径：`GET /api/user/profile`
 响应示例：

json

编辑

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "userId": 1,
    "username": "alice",
    "email": "alice@example.com",
    "avatarUrl": null
  },
  "timestamp": 1623456789000
}
```

#### 3.2.2 评分与收藏

**提交评分**
 路径：`POST /api/user/items/{itemId}/rate`
 请求参数：

json

编辑

```
{ "score": 9 }
```

> score 范围：1~10

响应示例：

json

编辑

```json
{
  "code": 200,
  "message": "评分成功",
  "data": {
    "ratingAvg": 9.25,
    "ratingCount": 1201
  },
  "timestamp": 1623456789000
}
```

**收藏/取消收藏**
 路径：`POST /api/user/items/{itemId}/favorite`
 响应示例：

json

编辑

```json
{
  "code": 200,
  "message": "操作成功",
  "data": { "isFavorited": true },
  "timestamp": 1623456789000
}
```

**获取我的收藏列表**
 路径：`GET /api/user/favorites`
 分页响应，包含 `itemId`, `title`, `coverUrl`, `type` 等字段。

#### 3.2.3 推荐功能（核心亮点！）

**获取基于标签的推荐**
 路径：`GET /api/user/recommendations/tag-based`
 逻辑：根据用户历史评分高的内容提取高频标签，推荐带相同标签的其他内容
 请求参数：`limit`（默认10）

响应示例：

json

编辑

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "itemId": 5,
      "title": "流浪地球",
      "type": "movie",
      "coverUrl": "...",
      "ratingAvg": 8.50,
      "tags": ["科幻", "灾难"]
    }
  ],
  "timestamp": 1623456789000
}
```

**获取热门内容推荐**
 路径：`GET /api/public/recommendations/popular`
 按 `viewCount` 或 `ratingCount` 排序的 Top N 内容 